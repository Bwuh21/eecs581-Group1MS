<!-- 
File Name: index.html
Project: Minesweeper (EECS 581 - Fall 2025)
Description: 
    Main entry point for the Minesweeper web application. 
    Provides structure for the user interface, including 
    the popup welcome overlay, draggable images, settings 
    panel, minesweeper grid, audio playback, and footer.

Inputs:
    - User inputs for game settings (width, height, number of mines).
    - Mouse events for dragging background images.
    - User interaction (clicks) to enable audio autoplay.

Outputs:
    - Visual Minesweeper grid generated via game.js.
    - Real-time status messages in the status indicator.
    - Flag counter displaying remaining flags.

External Sources:
    - Draggable image and cursor interaction pattern adapted from 
      common JavaScript drag-and-drop tutorials (e.g., MDN Web Docs).
    - Minesweeper core logic implemented in external file `game/game.js`.

Author: Reem Fatima, Pashia Vang, Alejandro Sandoval, Liam Aga, Jorge Trujillo, Aiden Barnard
Creation Date: September 08, 2025
===============================================================================
-->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Minesweeper</title>

	<!-- External stylesheet and favicon -->
	<link rel="stylesheet" href="styles.css?v=2">
	<link rel="icon" type="image/png" href="/images/lil nas x.png">
</head>

<body>
	<!-- Game Timer -->
	<div id="timer-bar" class="timer-bar">
		<span id="game-timer">Time: 00:00</span>
	</div>
	<!-- Background audio -->
	<audio id="minesweeper-audio" src="audio/lilnasX.mp3" autoplay loop></audio>

	<!-- SFX audio elements -->
	<audio id="sfx-mouse" src="audio/mouse.mp3" preload="auto"></audio>
	<audio id="sfx-bomb" src="audio/bomb.mp3" preload="auto"></audio>

	<audio id="sfx-win" src="audio/win.mp3" preload="auto"></audio>
	<audio id="sfx-lose" src="audio/lose.mp3" preload="auto"></audio>

	<!-- Overlay and popup -->
	<div id="popupOverlay"></div>
	<div id="popupContainer">
		<h2>Welcome!</h2>
		<p>PLAY</p>
		<button id="closePopup">begin</button>
	</div>

	<!-- Draggable background images -->
	<div class="background-images">
		<img src="images/lil nas x.png" alt="lil nas x" class="draggable"
			style="width:150px; top:10px; left:30px;">
		<img src="images/pinktruck.png" alt="pink truck" class="draggable" style="width:150px; top:620px; left:300px;">
		<img src="images/repaul.png" alt="repaul" class="draggable"
			style="width:150px; top:600px; left:1250px;">
		<img src="images/samsmith.jpg" alt="sam smith" class="draggable"
			style="width:150px; top:400px; left:200px;">
		<img src="images/tubby.jpeg" alt="tomater" class="draggable" style="width:100px; top:350px; left:1400px;">
		<img src="images/frankOcean.jpg" alt="frank ocean" class="draggable" style="width:120px; top:200px; left:1400px;">
		<img src="images/Ice-Spice.png" alt="ice spice" class="draggable" style="width:120px; top:200px; left:50px;">
	</div>


	<!-- Main content area -->
	<div class="content">
		<!-- Game settings form-->
		<div class="settings">
			<label>
				<!-- width -->
				Width:
				<input type="number" id="grid-width" value="10" min="5" max="30">
			</label>
			<label>
				<!-- height-->
				Height:
				<input type="number" id="grid-height" value="10" min="5" max="30">
			</label>
			<label>
				<!-- number of bombs-->
				Mines:
				<input type="number" id="bomb-count" value="10" min="1" max="99">
			</label>
			<!-- Audio settings -->
			<div class="audio-settings">
				<h3>Music</h3>
				<label for="audio-track">Track:</label>
				<select id="audio-track">
					<option value="lilnasX" selected>Lil</option>
					<option value="classic">Classic</option>
					<option value="rap">Rap</option>
				</select>
				<button id="play-audio" style="margin-left: 10px; background-color: black; color: white; border: 1px solid white; padding: 5px 10px; border-radius: 4px; cursor: pointer;">▶ Play</button>
			</div>
			<button id="start-game">Start Game</button>
			<div class="ai-buttons">
				<h3>AI Modes</h3>
				<button id="ai-easy">AI Easy</button>
				<button id="ai-medium">AI Medium</button>
				<button id="ai-hard">AI Hard</button>
			</div>
		</div>

		<!-- Dynamic status indicator (e.g., "You Won!" / "Game Over") -->
		<div class="status-indicator" id="status-indicator"></div>

		<!-- Flag counter display -->
		<div class="flag-counter-container">
			<p>⚑</p>
			<input type="number" id="flag-counter" value="10" placeholder="Mines" min="1" max="99">
		</div>

		<!-- Game grid will be generated here by game.js -->
		<div class="grid-container">
			<table class="grid-table">
				<tr>
					<td class="corner-cell"></td>
					<td class="column-label">A</td>
					<td class="column-label">B</td>
					<td class="column-label">C</td>
					<td class="column-label">D</td>
					<td class="column-label">E</td>
					<td class="column-label">F</td>
					<td class="column-label">G</td>
					<td class="column-label">H</td>
					<td class="column-label">I</td>
					<td class="column-label">J</td>
				</tr>
				<tr>
					<td class="row-label">1</td>
					<td colspan="10" rowspan="10">
						<div id="minesweeper-grid" class="minesweeper-grid"></div>
					</td>
				</tr>
				<tr><td class="row-label">2</td></tr>
				<tr><td class="row-label">3</td></tr>
				<tr><td class="row-label">4</td></tr>
				<tr><td class="row-label">5</td></tr>
				<tr><td class="row-label">6</td></tr>
				<tr><td class="row-label">7</td></tr>
				<tr><td class="row-label">8</td></tr>
				<tr><td class="row-label">9</td></tr>
				<tr><td class="row-label">10</td></tr>
			</table>
		</div>
		<script type="module" src="game/game.js"></script>
	</div>

	<!-- Inline JavaScript for draggable images and status updates -->
	<script src="game/draggable.js"></script>
	<script src="game/ai.js"></script>
	
	<!-- Audio track handling -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const audioTrack = document.getElementById('audio-track');
			const audio = document.getElementById('minesweeper-audio');
			const playButton = document.getElementById('play-audio');
				// Lower background music so SFX are audible
				if (audio) { audio.volume = 0.3; }
			
			// Play/Pause toggle
			playButton.addEventListener('click', function() {
				if (!audio) return;
				if (audio.paused) {
					audio.play().then(function() {
						playButton.textContent = '⏸ Pause';
					}).catch(function(error) {
						console.log('Audio play failed:', error);
						alert('Audio could not play. Try clicking the play button.');
					});
				} else {
					audio.pause();
					playButton.textContent = '▶ Play';
				}
			});
			
				// Try to play audio on user interaction and prime SFX elements
				function tryPlayAudio() {
				if (audio) {
					audio.play().then(function(){
						playButton.textContent = '⏸ Pause';
					}).catch(function(error) {
						console.log('Audio autoplay prevented:', error);
					});
				}
					// Prime SFX so subsequent play() calls are allowed and instant
					['sfx-mouse','sfx-bomb','sfx-win','sfx-lose'].forEach(function(id){
						var el = document.getElementById(id);
						if (!el) return;
						try {
							var prevVol = el.volume;
							el.volume = 0.0;
							el.play().then(function(){
								el.pause();
								el.currentTime = 0;
								el.volume = prevVol || 1.0;
							}).catch(function(){ /* ignore */ });
						} catch(e) { /* ignore */ }
					});
				}
			
			// Try to play when user clicks anywhere
			document.addEventListener('click', tryPlayAudio, { once: true });
			document.addEventListener('keydown', tryPlayAudio, { once: true });
			
			audioTrack.addEventListener('change', function() {
				const selectedTrack = this.value;
				audio.src = `audio/${selectedTrack}.mp3`;
				audio.load();
				audio.play().then(function(){
					playButton.textContent = '⏸ Pause';
				}).catch(function(error) {
					console.log('Audio play failed:', error);
				});
			});
		});
	</script>
</body>

<!-- Course footer-->
<footer>
	<p style="text-align: center;">EECS 581 - Fall 2025 - University of Kansas</p>
</footer>

</html>